import{c as K,d as j,r as E,h as A,W as B,w as H,a9 as J,aa as U,a3 as X,b as n,S as P,ab as S,ac as $,a4 as q,A as D,f as F,_ as M,P as V,a7 as I,D as x,E as T,M as o,F as v,R as Y,G,J as Q,N as O,K as Z,ad as ee,T as te,U as ae,Q as se,I as ne}from"./index-1a030643.js";import{I as oe}from"./index-377e1c2e.js";import{P as ie}from"./index-3c5dce32.js";import{k as le}from"./kana-74f6ec4e.js";import{N as ce}from"./index-9466c4ff.js";const[re,N,W]=K("signature"),ue={tips:String,type:S("png"),penColor:S("#000"),lineWidth:$(3),clearButtonText:String,backgroundColor:S(""),confirmButtonText:String},de=()=>{var e;const t=document.createElement("canvas");return!!((e=t.getContext)!=null&&e.call(t,"2d"))};var ve=j({name:re,props:ue,emits:["submit","clear","start","end","signing"],setup(e,{emit:t}){const c=E(),d=E(),a=A(()=>c.value?c.value.getContext("2d"):null),u=B?de():!0;let g=0,f=0,h;const _=()=>{if(!a.value)return!1;a.value.beginPath(),a.value.lineWidth=e.lineWidth,a.value.strokeStyle=e.penColor,h=q(c),t("start")},y=s=>{if(!a.value)return!1;D(s);const i=s.touches[0],l=i.clientX-((h==null?void 0:h.left)||0),b=i.clientY-((h==null?void 0:h.top)||0);a.value.lineCap="round",a.value.lineJoin="round",a.value.lineTo(l,b),a.value.stroke(),t("signing",s)},C=s=>{D(s),t("end")},k=s=>{const i=document.createElement("canvas");if(i.width=s.width,i.height=s.height,e.backgroundColor){const l=i.getContext("2d");r(l)}return s.toDataURL()===i.toDataURL()},r=s=>{s&&e.backgroundColor&&(s.fillStyle=e.backgroundColor,s.fillRect(0,0,g,f))},w=()=>{var s,i;const l=c.value;if(!l)return;const p=k(l)?"":((i=(s={jpg:()=>l.toDataURL("image/jpeg",.8),jpeg:()=>l.toDataURL("image/jpeg",.8)})[e.type])==null?void 0:i.call(s))||l.toDataURL(`image/${e.type}`);t("submit",{image:p,canvas:l})},L=()=>{a.value&&(a.value.clearRect(0,0,g,f),a.value.closePath(),r(a.value)),t("clear")},R=()=>{var s,i,l;if(u&&c.value){const b=c.value,p=B?window.devicePixelRatio:1;g=b.width=(((s=d.value)==null?void 0:s.offsetWidth)||0)*p,f=b.height=(((i=d.value)==null?void 0:i.offsetHeight)||0)*p,(l=a.value)==null||l.scale(p,p),r(a.value)}},z=()=>{if(a.value){const s=a.value.getImageData(0,0,g,f);R(),a.value.putImageData(s,0,0)}};return H(J,z),U(R),X({resize:z,clear:L,submit:w}),()=>n("div",{class:N()},[n("div",{class:N("content"),ref:d},[u?n("canvas",{ref:c,onTouchstartPassive:_,onTouchmove:y,onTouchend:C},null):n("p",null,[e.tips])]),n("div",{class:N("footer")},[n(P,{size:"small",onClick:L},{default:()=>[e.clearButtonText||W("clear")]}),n(P,{type:"primary",size:"small",onClick:w},{default:()=>[e.confirmButtonText||W("confirm")]})])])}});const me=F(ve);const he={name:"JpLearnTX",data(){return{kanaList:le,randomKanaList:[],audioPlayer:new Audio,target:{},rangeList:[],kanaType:0,rowNum:0,learnNum:0,kanaIndex:0,completeKanaList:[],painting:!1,canvas:null,ctx:null,lastX:0,lastY:0,canvasWidth:0,canvasHeight:0,image:""}},mounted(){let e=this.$route.query;console.log("query",e),this.rowNum=Number(e.rowNum),this.kanaType=Number(e.kanaType),this.learnNum=5*this.rowNum,window.addEventListener("resize",this.updateCanvasSize),this.collectKana()},beforeDestroy(){window.removeEventListener("resize",this.updateCanvasSize),this.$refs.signature.resize()},methods:{router(){return V},onSubmit(e){this.image=e.image},onClear(){this.$refs.signature.clear()},collectKana(){let e=this.kanaList;console.log(e);let t=[];e.slice(0,this.rowNum).forEach(d=>{d.forEach(a=>{a.Hiragana&&t.push(a)})}),this.rangeList=I.shuffleArray(t),this.next()},next(){let{rangeList:e,kanaIndex:t}=this;t>0&&t<=e.length&&(this.$refs.signature.submit(),this.completeKanaList.unshift(this.target),this.kanaIndex+=1,this.completeKanaList[0].txImage=this.image,this.image="",this.$refs.signature.clear()),t>=e.length?(console.log("全部完成"),I.showTips("全部完成 !","success"),setTimeout(()=>{},1500)):(this.target=e[t],this.kanaIndex=t+1,this.playAudio())},playAudio(e){let{audioPlayer:t,target:c}=this;t.src=c.audio,e&&(t.src=e),t.play().catch(d=>{console.log("音频播放错误",d),I.showTips("首次请手动点击播放","success")})},updateCanvasSize(){const e=this.$el.querySelector(".canvas-layout");this.canvasWidth=e.clientWidth,this.canvasHeight=e.clientHeight}}},m=e=>(te("data-v-b89e095f"),e=e(),ae(),e),_e={class:"JpLearn"},ge=m(()=>o("div",{class:"form-title"},null,-1)),fe={class:"step-Line"},pe=m(()=>o("div",{class:"form-title"},null,-1)),ye={class:"alias-layout"},ke={class:"column-container"},be=["onClick"],xe={class:"alias-text"},Ce=m(()=>o("div",{class:"form-title"},null,-1)),we=m(()=>o("div",{class:"form-title"},null,-1)),Le=m(()=>o("div",{class:"form-title"},null,-1)),Se={class:"canvas-container"},Ie={class:"canvas-layout"},Te=m(()=>o("div",{class:"func-text"},"重写",-1)),Ne=m(()=>o("div",{class:"func-text"},"重听",-1)),Re=m(()=>o("div",{class:"func-text"},"下一个",-1));function ze(e,t,c,d,a,u){const g=ce,f=ie,h=oe,_=se,y=Y,C=me,k=ne;return x(),T("div",_e,[n(g,{title:"假名听写","left-text":"返回","left-arrow":"",onClickLeft:t[0]||(t[0]=r=>u.router().back())}),ge,o("div",fe,[n(f,{inactive:"",percentage:((a.kanaIndex-1)/a.rangeList.length*100).toFixed(2)},null,8,["percentage"])]),pe,n(y,{justify:"center"},{default:v(()=>[n(_,{class:"alias-s"},{default:v(()=>[o("div",ye,[(x(!0),T(G,null,Q(a.completeKanaList,(r,w)=>(x(),T("div",ke,[o("div",{class:"alias-text",onClick:L=>u.playAudio(r.audio)},O(r.Hiragana),9,be),o("div",xe,[r.txImage?(x(),Z(h,{key:0,src:r.txImage},null,8,["src"])):ee("",!0)])]))),256))])]),_:1})]),_:1}),Ce,we,Le,o("div",Se,[n(y,{justify:"center"},{default:v(()=>[n(_,null,{default:v(()=>[o("div",Ie,[n(C,{"line-width":6,class:"van-signature",ref:"signature","background-color":"#eee",onSubmit:u.onSubmit},null,8,["onSubmit"])])]),_:1})]),_:1})]),n(y,{class:"lock-to-bottom",justify:"center",gutter:"70"},{default:v(()=>[n(_,{onClick:u.onClear},{default:v(()=>[n(k,{name:"replay",size:"5rem",color:"#b0dbda"}),Te]),_:1},8,["onClick"]),n(_,{onClick:t[1]||(t[1]=r=>u.playAudio())},{default:v(()=>[n(k,{name:"play-circle-o",size:"5rem",color:"#b0dbda"}),Ne]),_:1}),n(_,{onClick:u.next},{default:v(()=>[n(k,{name:"arrow",size:"5rem",color:"#b0dbda"}),Re]),_:1},8,["onClick"])]),_:1})])}const Ke=M(he,[["render",ze],["__scopeId","data-v-b89e095f"]]);export{Ke as default};
