import{c as q,d as V,p as P,g as Q,v as Y,x as B,i as Z,A as F,a9 as $,aa as ee,D as M,B as K,a as s,n as T,t as j,m as E,ab as te,ac as ae,L as W,I as O,w as G,y as ne,a1 as A,ad as se,ae as oe,K as H,af as ie,_ as re,a0 as le,$ as N,V as z,W as R,a3 as c,X as m,a8 as ce,S as ue,Y as de,a2 as U,ag as X,a5 as ve,a6 as fe,a7 as ge,a4 as he}from"./index-068e6b32.js";import{P as me}from"./index-5ef38513.js";import{k as _e,N as ye}from"./kana-5c458dba.js";const[ke,S]=q("image"),be={src:String,alt:String,fit:String,position:String,round:Boolean,block:Boolean,width:T,height:T,radius:T,lazyLoad:Boolean,iconSize:T,showError:j,errorIcon:E("photo-fail"),iconPrefix:String,showLoading:j,loadingIcon:E("photo"),crossorigin:String,referrerpolicy:String};var pe=V({name:ke,props:be,emits:["load","error"],setup(e,{emit:a,slots:i}){const r=P(!1),t=P(!0),l=P(),{$Lazyload:f}=Q().proxy,y=Y(()=>{const n={width:B(e.width),height:B(e.height)};return Z(e.radius)&&(n.overflow="hidden",n.borderRadius=B(e.radius)),n});F(()=>e.src,()=>{r.value=!1,t.value=!0});const h=n=>{t.value&&(t.value=!1,a("load",n))},g=()=>{const n=new Event("load");Object.defineProperty(n,"target",{value:l.value,enumerable:!0}),h(n)},k=n=>{r.value=!0,t.value=!1,a("error",n)},L=(n,p,o)=>o?o():s(O,{name:n,size:e.iconSize,class:p,classPrefix:e.iconPrefix},null),b=()=>{if(t.value&&e.showLoading)return s("div",{class:S("loading")},[L(e.loadingIcon,S("loading-icon"),i.loading)]);if(r.value&&e.showError)return s("div",{class:S("error")},[L(e.errorIcon,S("error-icon"),i.error)])},u=()=>{if(r.value||!e.src)return;const n={alt:e.alt,class:S("img"),style:{objectFit:e.fit,objectPosition:e.position},crossorigin:e.crossorigin,referrerpolicy:e.referrerpolicy};return e.lazyLoad?te(s("img",W({ref:l},n),null),[[ae("lazy"),e.src]]):s("img",W({ref:l,src:e.src,onLoad:h,onError:k},n),null)},w=({el:n})=>{const p=()=>{n===l.value&&t.value&&g()};l.value?p():K(p)},x=({el:n})=>{n===l.value&&!r.value&&k()};return f&&$&&(f.$on("loaded",w),f.$on("error",x),ee(()=>{f.$off("loaded",w),f.$off("error",x)})),M(()=>{K(()=>{var n;(n=l.value)!=null&&n.complete&&!e.lazyLoad&&g()})}),()=>{var n;return s("div",{class:S({round:e.round,block:e.block}),style:y.value},[u(),b(),(n=i.default)==null?void 0:n.call(i)])}}});const Le=G(pe),[we,D,J]=q("signature"),xe={tips:String,type:E("png"),penColor:E("#000"),lineWidth:se(3),clearButtonText:String,backgroundColor:E(""),confirmButtonText:String},Ce=()=>{var e;const a=document.createElement("canvas");return!!((e=a.getContext)!=null&&e.call(a,"2d"))};var Se=V({name:we,props:xe,emits:["submit","clear","start","end","signing"],setup(e,{emit:a}){const i=P(),r=P(),t=Y(()=>i.value?i.value.getContext("2d"):null),l=$?Ce():!0;let f=0,y=0,h;const g=()=>{if(!t.value)return!1;t.value.beginPath(),t.value.lineWidth=e.lineWidth,t.value.strokeStyle=e.penColor,h=oe(i),a("start")},k=o=>{if(!t.value)return!1;H(o);const d=o.touches[0],v=d.clientX-((h==null?void 0:h.left)||0),I=d.clientY-((h==null?void 0:h.top)||0);t.value.lineCap="round",t.value.lineJoin="round",t.value.lineTo(v,I),t.value.stroke(),a("signing",o)},L=o=>{H(o),a("end")},b=o=>{const d=document.createElement("canvas");if(d.width=o.width,d.height=o.height,e.backgroundColor){const v=d.getContext("2d");u(v)}return o.toDataURL()===d.toDataURL()},u=o=>{o&&e.backgroundColor&&(o.fillStyle=e.backgroundColor,o.fillRect(0,0,f,y))},w=()=>{var o,d;const v=i.value;if(!v)return;const C=b(v)?"":((d=(o={jpg:()=>v.toDataURL("image/jpeg",.8),jpeg:()=>v.toDataURL("image/jpeg",.8)})[e.type])==null?void 0:d.call(o))||v.toDataURL(`image/${e.type}`);a("submit",{image:C,canvas:v})},x=()=>{t.value&&(t.value.clearRect(0,0,f,y),t.value.closePath(),u(t.value)),a("clear")},n=()=>{var o,d,v;if(l&&i.value){const I=i.value,C=$?window.devicePixelRatio:1;f=I.width=(((o=r.value)==null?void 0:o.offsetWidth)||0)*C,y=I.height=(((d=r.value)==null?void 0:d.offsetHeight)||0)*C,(v=t.value)==null||v.scale(C,C),u(t.value)}},p=()=>{if(t.value){const o=t.value.getImageData(0,0,f,y);n(),t.value.putImageData(o,0,0)}};return F(ie,p),M(n),ne({resize:p,clear:x,submit:w}),()=>s("div",{class:D()},[s("div",{class:D("content"),ref:r},[l?s("canvas",{ref:i,onTouchstartPassive:g,onTouchmove:k,onTouchend:L},null):s("p",null,[e.tips])]),s("div",{class:D("footer")},[s(A,{size:"small",onClick:x},{default:()=>[e.clearButtonText||J("clear")]}),s(A,{type:"primary",size:"small",onClick:w},{default:()=>[e.confirmButtonText||J("confirm")]})])])}});const Ie=G(Se);const ze={name:"JpLearnTX",data(){return{kanaList:_e,randomKanaList:[],audioPlayer:new Audio,target:{},rangeList:[],kanaType:0,rowNum:0,learnNum:0,kanaIndex:0,completeKanaList:[],painting:!1,canvas:null,ctx:null,lastX:0,lastY:0,canvasWidth:0,canvasHeight:0,image:""}},mounted(){let e=this.$route.query;console.log("query",e),this.rowNum=Number(e.rowNum),this.kanaType=Number(e.kanaType);let a=e.rowIndex.split(","),i=[];a.forEach(r=>{r=Number(r),i.push(this.kanaList[r])}),this.kanaList=i,this.learnNum=5*this.rowNum,window.addEventListener("resize",this.updateCanvasSize),this.collectKana()},beforeDestroy(){window.removeEventListener("resize",this.updateCanvasSize),this.$refs.signature.resize()},methods:{router(){return le},onSubmit(e){this.image=e.image},onClear(){this.$refs.signature.clear()},collectKana(){let e=this.kanaList;console.log(e);let a=[];e.slice(0,this.rowNum).forEach(r=>{r.forEach(t=>{t.Hiragana&&a.push(t)})}),this.rangeList=N.shuffleArray(a),this.next()},next(){let{rangeList:e,kanaIndex:a}=this;a>0&&a<=e.length&&(this.$refs.signature.submit(),this.completeKanaList.unshift(this.target),this.kanaIndex+=1,this.completeKanaList[0].txImage=this.image,this.image="",this.$refs.signature.clear()),a>=e.length?(console.log("全部完成"),N.showTips("全部完成 !","success")):(this.target=e[a],this.kanaIndex=a+1,this.playAudio())},playAudio(e){let{audioPlayer:a,target:i}=this;a.src=i.audio,e&&(a.src=e),a.play().catch(r=>{console.log("音频播放错误",r),N.showTips("首次请手动点击播放","success")})},updateCanvasSize(){const e=this.$el.querySelector(".canvas-layout");this.canvasWidth=e.clientWidth,this.canvasHeight=e.clientHeight}}},_=e=>(ve("data-v-af2e32db"),e=e(),fe(),e),Pe={class:"JpLearn"},Ee=_(()=>c("div",{class:"form-title"},null,-1)),Te={class:"step-Line"},Be=_(()=>c("div",{class:"form-title"},null,-1)),Ne={class:"alias-layout"},Re={class:"column-container"},De=["onClick"],$e={class:"alias-text"},Ke=_(()=>c("div",{class:"form-title"},null,-1)),je=_(()=>c("div",{class:"form-title"},null,-1)),We=_(()=>c("div",{class:"form-title"},null,-1)),Ae={class:"canvas-container"},He={class:"canvas-layout"},Ue=_(()=>c("div",{class:"func-text"},"重写",-1)),Xe=_(()=>c("div",{class:"func-text"},"重听",-1)),Je=_(()=>c("div",{class:"func-text"},"下一个",-1)),qe=_(()=>c("div",{class:"func-text"},"返回",-1));function Ve(e,a,i,r,t,l){const f=ye,y=me,h=Le,g=ge,k=ce,L=Ie,b=O;return z(),R("div",Pe,[s(f,{title:this.kanaType===1?"平假名听写":"片假名听写","left-text":"返回","left-arrow":"",onClickLeft:a[0]||(a[0]=u=>l.router().back())},null,8,["title"]),Ee,c("div",Te,[s(y,{inactive:"",percentage:((t.kanaIndex-1)/t.rangeList.length*100).toFixed(2)},null,8,["percentage"])]),Be,s(k,{justify:"center"},{default:m(()=>[s(g,{class:"alias-s"},{default:m(()=>[c("div",Ne,[(z(!0),R(ue,null,de(t.completeKanaList,(u,w)=>(z(),R("div",Re,[c("div",{class:"alias-text",onClick:x=>l.playAudio(u.audio)},he(t.kanaType===1?u.Hiragana:u.Katakana),9,De),c("div",$e,[u.txImage?(z(),U(h,{key:0,src:u.txImage},null,8,["src"])):X("",!0)])]))),256))])]),_:1})]),_:1}),Ke,je,We,c("div",Ae,[s(k,{justify:"center"},{default:m(()=>[s(g,null,{default:m(()=>[c("div",He,[s(L,{"line-width":6,class:"van-signature",ref:"signature","background-color":"#eee",onSubmit:l.onSubmit},null,8,["onSubmit"])])]),_:1})]),_:1})]),s(k,{class:"lock-to-bottom",justify:"space-between"},{default:m(()=>[s(g,{onClick:l.onClear},{default:m(()=>[s(b,{name:"replay",size:"5rem",color:"#b0dbda"}),Ue]),_:1},8,["onClick"]),s(g,{onClick:a[1]||(a[1]=u=>l.playAudio())},{default:m(()=>[s(b,{name:"play-circle-o",size:"5rem",color:"#b0dbda"}),Xe]),_:1}),s(g,{onClick:l.next},{default:m(()=>[s(b,{name:"arrow",size:"5rem",color:"#b0dbda"}),Je]),_:1},8,["onClick"]),t.kanaIndex>t.rangeList.length?(z(),U(g,{key:0,onClick:a[2]||(a[2]=u=>l.router().back())},{default:m(()=>[s(b,{name:"revoke",size:"5rem",color:"#b0dbda"}),qe]),_:1})):X("",!0)]),_:1})])}const Oe=re(ze,[["render",Ve],["__scopeId","data-v-af2e32db"]]);export{Oe as default};
