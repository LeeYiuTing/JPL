import{c as V,d as Y,p as T,g as Q,v as q,x as B,i as Z,A as F,a9 as j,aa as ee,D as M,B as K,a as o,n as E,t as $,m as z,ab as te,ac as ae,L as W,I as O,w as G,y as ne,a1 as A,ad as oe,ae as se,K as U,af as ie,_ as le,a0 as re,$ as R,V as P,W as D,a2 as c,X as m,a8 as ce,S as ue,Y as de,a3 as X,ag as H,a5 as ve,a6 as fe,a7 as ge,a4 as he}from"./index-18b25ed7.js";import{P as me}from"./index-a4450d78.js";import{k as _e,N as ye}from"./kana-13e22726.js";const[ke,I]=V("image"),be={src:String,alt:String,fit:String,position:String,round:Boolean,block:Boolean,width:E,height:E,radius:E,lazyLoad:Boolean,iconSize:E,showError:$,errorIcon:z("photo-fail"),iconPrefix:String,showLoading:$,loadingIcon:z("photo"),crossorigin:String,referrerpolicy:String};var pe=Y({name:ke,props:be,emits:["load","error"],setup(e,{emit:t,slots:i}){const r=T(!1),a=T(!0),l=T(),{$Lazyload:f}=Q().proxy,y=q(()=>{const n={width:B(e.width),height:B(e.height)};return Z(e.radius)&&(n.overflow="hidden",n.borderRadius=B(e.radius)),n});F(()=>e.src,()=>{r.value=!1,a.value=!0});const h=n=>{a.value&&(a.value=!1,t("load",n))},g=()=>{const n=new Event("load");Object.defineProperty(n,"target",{value:l.value,enumerable:!0}),h(n)},k=n=>{r.value=!0,a.value=!1,t("error",n)},x=(n,p,s)=>s?s():o(O,{name:n,size:e.iconSize,class:p,classPrefix:e.iconPrefix},null),b=()=>{if(a.value&&e.showLoading)return o("div",{class:I("loading")},[x(e.loadingIcon,I("loading-icon"),i.loading)]);if(r.value&&e.showError)return o("div",{class:I("error")},[x(e.errorIcon,I("error-icon"),i.error)])},u=()=>{if(r.value||!e.src)return;const n={alt:e.alt,class:I("img"),style:{objectFit:e.fit,objectPosition:e.position},crossorigin:e.crossorigin,referrerpolicy:e.referrerpolicy};return e.lazyLoad?te(o("img",W({ref:l},n),null),[[ae("lazy"),e.src]]):o("img",W({ref:l,src:e.src,onLoad:h,onError:k},n),null)},L=({el:n})=>{const p=()=>{n===l.value&&a.value&&g()};l.value?p():K(p)},w=({el:n})=>{n===l.value&&!r.value&&k()};return f&&j&&(f.$on("loaded",L),f.$on("error",w),ee(()=>{f.$off("loaded",L),f.$off("error",w)})),M(()=>{K(()=>{var n;(n=l.value)!=null&&n.complete&&!e.lazyLoad&&g()})}),()=>{var n;return o("div",{class:I({round:e.round,block:e.block}),style:y.value},[u(),b(),(n=i.default)==null?void 0:n.call(i)])}}});const xe=G(pe),[Le,N,J]=V("signature"),we={tips:String,type:z("png"),penColor:z("#000"),lineWidth:oe(3),clearButtonText:String,backgroundColor:z(""),confirmButtonText:String},Ce=()=>{var e;const t=document.createElement("canvas");return!!((e=t.getContext)!=null&&e.call(t,"2d"))};var Ie=Y({name:Le,props:we,emits:["submit","clear","start","end","signing"],setup(e,{emit:t}){const i=T(),r=T(),a=q(()=>i.value?i.value.getContext("2d"):null),l=j?Ce():!0;let f=0,y=0,h;const g=()=>{if(!a.value)return!1;a.value.beginPath(),a.value.lineWidth=e.lineWidth,a.value.strokeStyle=e.penColor,h=se(i),t("start")},k=s=>{if(!a.value)return!1;U(s);const d=s.touches[0],v=d.clientX-((h==null?void 0:h.left)||0),S=d.clientY-((h==null?void 0:h.top)||0);a.value.lineCap="round",a.value.lineJoin="round",a.value.lineTo(v,S),a.value.stroke(),t("signing",s)},x=s=>{U(s),t("end")},b=s=>{const d=document.createElement("canvas");if(d.width=s.width,d.height=s.height,e.backgroundColor){const v=d.getContext("2d");u(v)}return s.toDataURL()===d.toDataURL()},u=s=>{s&&e.backgroundColor&&(s.fillStyle=e.backgroundColor,s.fillRect(0,0,f,y))},L=()=>{var s,d;const v=i.value;if(!v)return;const C=b(v)?"":((d=(s={jpg:()=>v.toDataURL("image/jpeg",.8),jpeg:()=>v.toDataURL("image/jpeg",.8)})[e.type])==null?void 0:d.call(s))||v.toDataURL(`image/${e.type}`);t("submit",{image:C,canvas:v})},w=()=>{a.value&&(a.value.clearRect(0,0,f,y),a.value.closePath(),u(a.value)),t("clear")},n=()=>{var s,d,v;if(l&&i.value){const S=i.value,C=j?window.devicePixelRatio:1;f=S.width=(((s=r.value)==null?void 0:s.offsetWidth)||0)*C,y=S.height=(((d=r.value)==null?void 0:d.offsetHeight)||0)*C,(v=a.value)==null||v.scale(C,C),u(a.value)}},p=()=>{if(a.value){const s=a.value.getImageData(0,0,f,y);n(),a.value.putImageData(s,0,0)}};return F(ie,p),M(n),ne({resize:p,clear:w,submit:L}),()=>o("div",{class:N()},[o("div",{class:N("content"),ref:r},[l?o("canvas",{ref:i,onTouchstartPassive:g,onTouchmove:k,onTouchend:x},null):o("p",null,[e.tips])]),o("div",{class:N("footer")},[o(A,{size:"small",onClick:w},{default:()=>[e.clearButtonText||J("clear")]}),o(A,{type:"primary",size:"small",onClick:L},{default:()=>[e.confirmButtonText||J("confirm")]})])])}});const Se=G(Ie);const Pe={name:"JpLearnTX",data(){return{kanaList:_e,randomKanaList:[],audioPlayer:new Audio,target:{},rangeList:[],kanaType:0,rowNum:0,learnNum:0,kanaIndex:0,completeKanaList:[],painting:!1,canvas:null,ctx:null,lastX:0,lastY:0,canvasWidth:0,canvasHeight:0,image:""}},mounted(){let e=this.$route.query;console.log("query",e),this.kanaType=Number(e.kanaType);let t=e.rowIndex.split(","),i=[];t.forEach(r=>{r=Number(r),i.push(this.kanaList[r])}),this.kanaList=i,this.learnNum=5*this.rowNum,this.collectKana()},methods:{router(){return re},onSubmit(e){this.image=e.image},onClear(){this.$refs.signature.clear()},collectKana(){let e=[];this.kanaList.forEach(t=>{t.forEach(i=>{i.Hiragana&&e.push(i)})}),this.rangeList=R.shuffleArray(e),this.next()},next(){let{rangeList:e,kanaIndex:t}=this;t>0&&t<=e.length&&(this.$refs.signature.submit(),this.completeKanaList.unshift(this.target),this.kanaIndex+=1,this.completeKanaList[0].txImage=this.image,this.image="",this.$refs.signature.clear()),t>=e.length?(console.log("全部完成"),R.showTips("全部完成 !","success")):(this.target=e[t],this.kanaIndex=t+1,this.playAudio())},playAudio(e){let{audioPlayer:t,target:i}=this;t.src=i.audio,e&&(t.src=e),t.play().catch(r=>{console.log("音频播放错误",r),R.showTips("首次请手动点击播放","success")})}}},_=e=>(ve("data-v-f3556c0b"),e=e(),fe(),e),Te={class:"JpLearn"},ze=_(()=>c("div",{class:"form-title"},null,-1)),Ee={class:"step-Line"},Be=_(()=>c("div",{class:"form-title"},null,-1)),Re={class:"alias-layout"},De={class:"column-container"},Ne=["onClick"],je={class:"alias-text"},Ke=_(()=>c("div",{class:"form-title"},null,-1)),$e=_(()=>c("div",{class:"form-title"},null,-1)),We=_(()=>c("div",{class:"form-title"},null,-1)),Ae={class:"canvas-container"},Ue={class:"canvas-layout"},Xe=_(()=>c("div",{class:"func-text"},"返回",-1)),He=_(()=>c("div",{class:"func-text"},"重写",-1)),Je=_(()=>c("div",{class:"func-text"},"重听",-1)),Ve=_(()=>c("div",{class:"func-text"},"下一个",-1));function Ye(e,t,i,r,a,l){const f=ye,y=me,h=xe,g=ge,k=ce,x=Se,b=O;return P(),D("div",Te,[o(f,{title:this.kanaType===1?"平假名听写":"片假名听写","left-text":"返回","left-arrow":"",onClickLeft:t[0]||(t[0]=u=>l.router().back())},null,8,["title"]),ze,c("div",Ee,[o(y,{inactive:"",percentage:((a.kanaIndex-1)/a.rangeList.length*100).toFixed(2)},null,8,["percentage"])]),Be,o(k,{justify:"center"},{default:m(()=>[o(g,{class:"alias-s"},{default:m(()=>[c("div",Re,[(P(!0),D(ue,null,de(a.completeKanaList,(u,L)=>(P(),D("div",De,[c("div",{class:"alias-text",onClick:w=>l.playAudio(u.audio)},he(a.kanaType===1?u.Hiragana:u.Katakana),9,Ne),c("div",je,[u.txImage?(P(),X(h,{key:0,src:u.txImage},null,8,["src"])):H("",!0)])]))),256))])]),_:1})]),_:1}),Ke,$e,We,c("div",Ae,[o(k,{justify:"center"},{default:m(()=>[o(g,null,{default:m(()=>[c("div",Ue,[o(x,{"line-width":6,class:"van-signature",ref:"signature","background-color":"#eee",onSubmit:l.onSubmit},null,8,["onSubmit"])])]),_:1})]),_:1})]),o(k,{class:"lock-to-bottom",justify:"space-between"},{default:m(()=>[a.kanaIndex>a.rangeList.length?(P(),X(g,{key:0,onClick:t[1]||(t[1]=u=>l.router().back())},{default:m(()=>[o(b,{name:"revoke",size:"5rem",color:"#b0dbda"}),Xe]),_:1})):H("",!0),o(g,{onClick:l.onClear},{default:m(()=>[o(b,{name:"replay",size:"5rem",color:"#b0dbda"}),He]),_:1},8,["onClick"]),o(g,{onClick:t[2]||(t[2]=u=>l.playAudio())},{default:m(()=>[o(b,{name:"play-circle-o",size:"5rem",color:"#b0dbda"}),Je]),_:1}),o(g,{onClick:l.next},{default:m(()=>[o(b,{name:"arrow",size:"5rem",color:"#b0dbda"}),Ve]),_:1},8,["onClick"])]),_:1})])}const Oe=le(Pe,[["render",Ye],["__scopeId","data-v-f3556c0b"]]);export{Oe as default};
