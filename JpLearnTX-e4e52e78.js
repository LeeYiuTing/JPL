import{c as q,d as F,p as P,g as Q,v as V,x as B,i as Z,A as Y,ag as j,ah as ee,B as M,D as $,a as o,n as T,t as K,m as E,W as te,ai as ae,L as W,I as O,w as G,y as ne,a8 as A,aj as oe,ak as se,K as H,al as ie,a0 as le,a6 as re,a7 as N,a1 as z,a2 as R,aa as r,a3 as m,af as ce,S as ue,a4 as de,a9 as U,am as X,ac as ve,ad as fe,ae as ge,ab as he}from"./index-ba12e32f.js";import{P as me}from"./index-bb15472a.js";import{k as _e,N as ye}from"./kana-2dada3e7.js";const[ke,S]=q("image"),be={src:String,alt:String,fit:String,position:String,round:Boolean,block:Boolean,width:T,height:T,radius:T,lazyLoad:Boolean,iconSize:T,showError:K,errorIcon:E("photo-fail"),iconPrefix:String,showLoading:K,loadingIcon:E("photo"),crossorigin:String,referrerpolicy:String};var pe=F({name:ke,props:be,emits:["load","error"],setup(e,{emit:a,slots:l}){const c=P(!1),t=P(!0),i=P(),{$Lazyload:f}=Q().proxy,y=V(()=>{const n={width:B(e.width),height:B(e.height)};return Z(e.radius)&&(n.overflow="hidden",n.borderRadius=B(e.radius)),n});Y(()=>e.src,()=>{c.value=!1,t.value=!0});const h=n=>{t.value&&(t.value=!1,a("load",n))},g=()=>{const n=new Event("load");Object.defineProperty(n,"target",{value:i.value,enumerable:!0}),h(n)},k=n=>{c.value=!0,t.value=!1,a("error",n)},w=(n,p,s)=>s?s():o(O,{name:n,size:e.iconSize,class:p,classPrefix:e.iconPrefix},null),b=()=>{if(t.value&&e.showLoading)return o("div",{class:S("loading")},[w(e.loadingIcon,S("loading-icon"),l.loading)]);if(c.value&&e.showError)return o("div",{class:S("error")},[w(e.errorIcon,S("error-icon"),l.error)])},u=()=>{if(c.value||!e.src)return;const n={alt:e.alt,class:S("img"),style:{objectFit:e.fit,objectPosition:e.position},crossorigin:e.crossorigin,referrerpolicy:e.referrerpolicy};return e.lazyLoad?te(o("img",W({ref:i},n),null),[[ae("lazy"),e.src]]):o("img",W({ref:i,src:e.src,onLoad:h,onError:k},n),null)},x=({el:n})=>{const p=()=>{n===i.value&&t.value&&g()};i.value?p():$(p)},L=({el:n})=>{n===i.value&&!c.value&&k()};return f&&j&&(f.$on("loaded",x),f.$on("error",L),ee(()=>{f.$off("loaded",x),f.$off("error",L)})),M(()=>{$(()=>{var n;(n=i.value)!=null&&n.complete&&!e.lazyLoad&&g()})}),()=>{var n;return o("div",{class:S({round:e.round,block:e.block}),style:y.value},[u(),b(),(n=l.default)==null?void 0:n.call(l)])}}});const we=G(pe),[xe,D,J]=q("signature"),Le={tips:String,type:E("png"),penColor:E("#000"),lineWidth:oe(3),clearButtonText:String,backgroundColor:E(""),confirmButtonText:String},Ce=()=>{var e;const a=document.createElement("canvas");return!!((e=a.getContext)!=null&&e.call(a,"2d"))};var Se=F({name:xe,props:Le,emits:["submit","clear","start","end","signing"],setup(e,{emit:a}){const l=P(),c=P(),t=V(()=>l.value?l.value.getContext("2d"):null),i=j?Ce():!0;let f=0,y=0,h;const g=()=>{if(!t.value)return!1;t.value.beginPath(),t.value.lineWidth=e.lineWidth,t.value.strokeStyle=e.penColor,h=se(l),a("start")},k=s=>{if(!t.value)return!1;H(s);const d=s.touches[0],v=d.clientX-((h==null?void 0:h.left)||0),I=d.clientY-((h==null?void 0:h.top)||0);t.value.lineCap="round",t.value.lineJoin="round",t.value.lineTo(v,I),t.value.stroke(),a("signing",s)},w=s=>{H(s),a("end")},b=s=>{const d=document.createElement("canvas");if(d.width=s.width,d.height=s.height,e.backgroundColor){const v=d.getContext("2d");u(v)}return s.toDataURL()===d.toDataURL()},u=s=>{s&&e.backgroundColor&&(s.fillStyle=e.backgroundColor,s.fillRect(0,0,f,y))},x=()=>{var s,d;const v=l.value;if(!v)return;const C=b(v)?"":((d=(s={jpg:()=>v.toDataURL("image/jpeg",.8),jpeg:()=>v.toDataURL("image/jpeg",.8)})[e.type])==null?void 0:d.call(s))||v.toDataURL(`image/${e.type}`);a("submit",{image:C,canvas:v})},L=()=>{t.value&&(t.value.clearRect(0,0,f,y),t.value.closePath(),u(t.value)),a("clear")},n=()=>{var s,d,v;if(i&&l.value){const I=l.value,C=j?window.devicePixelRatio:1;f=I.width=(((s=c.value)==null?void 0:s.offsetWidth)||0)*C,y=I.height=(((d=c.value)==null?void 0:d.offsetHeight)||0)*C,(v=t.value)==null||v.scale(C,C),u(t.value)}},p=()=>{if(t.value){const s=t.value.getImageData(0,0,f,y);n(),t.value.putImageData(s,0,0)}};return Y(ie,p),M(n),ne({resize:p,clear:L,submit:x}),()=>o("div",{class:D()},[o("div",{class:D("content"),ref:c},[i?o("canvas",{ref:l,onTouchstartPassive:g,onTouchmove:k,onTouchend:w},null):o("p",null,[e.tips])]),o("div",{class:D("footer")},[o(A,{size:"small",onClick:L},{default:()=>[e.clearButtonText||J("clear")]}),o(A,{type:"primary",size:"small",onClick:x},{default:()=>[e.confirmButtonText||J("confirm")]})])])}});const Ie=G(Se);const ze={name:"JpLearnTX",data(){return{kanaList:_e,randomKanaList:[],audioPlayer:new Audio,target:{},rangeList:[],kanaType:0,rowNum:0,learnNum:0,kanaIndex:0,completeKanaList:[],painting:!1,canvas:null,ctx:null,lastX:0,lastY:0,canvasWidth:0,canvasHeight:0,image:""}},mounted(){let e=this.$route.query;console.log("query",e),this.rowNum=Number(e.rowNum),this.kanaType=Number(e.kanaType),this.learnNum=5*this.rowNum,window.addEventListener("resize",this.updateCanvasSize),this.collectKana()},beforeDestroy(){window.removeEventListener("resize",this.updateCanvasSize),this.$refs.signature.resize()},methods:{router(){return re},onSubmit(e){this.image=e.image},onClear(){this.$refs.signature.clear()},collectKana(){let e=this.kanaList;console.log(e);let a=[];e.slice(0,this.rowNum).forEach(c=>{c.forEach(t=>{t.Hiragana&&a.push(t)})}),this.rangeList=N.shuffleArray(a),this.next()},next(){let{rangeList:e,kanaIndex:a}=this;a>0&&a<=e.length&&(this.$refs.signature.submit(),this.completeKanaList.unshift(this.target),this.kanaIndex+=1,this.completeKanaList[0].txImage=this.image,this.image="",this.$refs.signature.clear()),a>=e.length?(console.log("全部完成"),N.showTips("全部完成 !","success")):(this.target=e[a],this.kanaIndex=a+1,this.playAudio())},playAudio(e){let{audioPlayer:a,target:l}=this;a.src=l.audio,e&&(a.src=e),a.play().catch(c=>{console.log("音频播放错误",c),N.showTips("首次请手动点击播放","success")})},updateCanvasSize(){const e=this.$el.querySelector(".canvas-layout");this.canvasWidth=e.clientWidth,this.canvasHeight=e.clientHeight}}},_=e=>(ve("data-v-f6cb5c65"),e=e(),fe(),e),Pe={class:"JpLearn"},Ee=_(()=>r("div",{class:"form-title"},null,-1)),Te={class:"step-Line"},Be=_(()=>r("div",{class:"form-title"},null,-1)),Ne={class:"alias-layout"},Re={class:"column-container"},De=["onClick"],je={class:"alias-text"},$e=_(()=>r("div",{class:"form-title"},null,-1)),Ke=_(()=>r("div",{class:"form-title"},null,-1)),We=_(()=>r("div",{class:"form-title"},null,-1)),Ae={class:"canvas-container"},He={class:"canvas-layout"},Ue=_(()=>r("div",{class:"func-text"},"重写",-1)),Xe=_(()=>r("div",{class:"func-text"},"重听",-1)),Je=_(()=>r("div",{class:"func-text"},"下一个",-1)),qe=_(()=>r("div",{class:"func-text"},"返回",-1));function Fe(e,a,l,c,t,i){const f=ye,y=me,h=we,g=ge,k=ce,w=Ie,b=O;return z(),R("div",Pe,[o(f,{title:this.kanaType===1?"平假名听写":"片假名听写","left-text":"返回","left-arrow":"",onClickLeft:a[0]||(a[0]=u=>i.router().back())},null,8,["title"]),Ee,r("div",Te,[o(y,{inactive:"",percentage:((t.kanaIndex-1)/t.rangeList.length*100).toFixed(2)},null,8,["percentage"])]),Be,o(k,{justify:"center"},{default:m(()=>[o(g,{class:"alias-s"},{default:m(()=>[r("div",Ne,[(z(!0),R(ue,null,de(t.completeKanaList,(u,x)=>(z(),R("div",Re,[r("div",{class:"alias-text",onClick:L=>i.playAudio(u.audio)},he(t.kanaType===1?u.Hiragana:u.Katakana),9,De),r("div",je,[u.txImage?(z(),U(h,{key:0,src:u.txImage},null,8,["src"])):X("",!0)])]))),256))])]),_:1})]),_:1}),$e,Ke,We,r("div",Ae,[o(k,{justify:"center"},{default:m(()=>[o(g,null,{default:m(()=>[r("div",He,[o(w,{"line-width":6,class:"van-signature",ref:"signature","background-color":"#eee",onSubmit:i.onSubmit},null,8,["onSubmit"])])]),_:1})]),_:1})]),o(k,{class:"lock-to-bottom",justify:"space-between"},{default:m(()=>[o(g,{onClick:i.onClear},{default:m(()=>[o(b,{name:"replay",size:"5rem",color:"#b0dbda"}),Ue]),_:1},8,["onClick"]),o(g,{onClick:a[1]||(a[1]=u=>i.playAudio())},{default:m(()=>[o(b,{name:"play-circle-o",size:"5rem",color:"#b0dbda"}),Xe]),_:1}),o(g,{onClick:i.next},{default:m(()=>[o(b,{name:"arrow",size:"5rem",color:"#b0dbda"}),Je]),_:1},8,["onClick"]),t.kanaIndex>t.rangeList.length?(z(),U(g,{key:0,onClick:a[2]||(a[2]=u=>i.router().back())},{default:m(()=>[o(b,{name:"revoke",size:"5rem",color:"#b0dbda"}),qe]),_:1})):X("",!0)]),_:1})])}const Oe=le(ze,[["render",Fe],["__scopeId","data-v-f6cb5c65"]]);export{Oe as default};
